<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>SUT Kontrol Sistemi</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.1/dist/tesseract.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f2f6fc; margin: 0; padding: 20px; }
    h1 { color: #1a237e; }
    textarea, select, button, input { width: 100%; padding: 10px; margin-top: 15px; font-size: 16px; }
    .result { margin-top: 20px; padding: 15px; border-radius: 8px; background: #ffffff; box-shadow: 0px 2px 5px rgba(0,0,0,0.1); }
    .result.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .result.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .result.info { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
    .answer-buttons { margin-top: 10px; display: flex; gap: 10px; }
    .answer-buttons button { flex: 1; }
  </style>
</head>
<body>

<h1>SUT Kontrol Sistemi</h1>

<!-- Giriş ekranı -->
<div id="loginScreen">
  <h2>Giriş Yap</h2>
  <input type="text" id="username" placeholder="Kullanıcı Adı">
  <input type="password" id="password" placeholder="Şifre">
  <button onclick="login()">Giriş Yap</button>
  <div id="loginError" style="color: red; margin-top: 10px;"></div>
</div>

<!-- Ana içerik -->
<div id="mainContent" style="display:none;">
  <!-- Reçete metni yapıştırma -->
  <label for="recete">Reçete Metni Yapıştırın:</label>
  <textarea id="recete" rows="6" placeholder="Buraya reçete metnini yapıştırın..."></textarea>
  <button onclick="receteTara()">Taramaya Başla</button>

  <!-- Dosya yükleme alanı -->
  <h2>Veya Dosya Yükle (PDF veya Görsel):</h2>
  <input type="file" id="fileInput" accept=".pdf,image/*" onchange="dosyaOku()">
  <div id="progress"></div>

  <!-- Bulunan sonuçlar -->
  <div id="bulunanlar" class="result info" style="display:none;"></div>

  <hr>

  <!-- İlaç seçimi -->
  <h2>Veya İlaç Seçimi:</h2>
  <label for="ilac">İlaç Seçimi:</label>
  <select id="ilac" onchange="ilacSecildi()">
    <option value="">-- İlaç Seçin --</option>
    <option value="Exforge">Amlodipin + Valsartan (Exforge)</option>
    <option value="Micardis Plus">Telmisartan + HCT (Micardis Plus)</option>
    <option value="Telmisartan">Telmisartan (Micardis)</option>
    <option value="Losartan">Losartan (Cozaar)</option>
    <option value="Amlodipin">Amlodipin (Norvasc)</option>
    <option value="Aranesp">Darbepoetin Alfa (Aranesp)</option>
    <option value="Eprex">Epoetin Alfa (Eprex)</option>
    <option value="Retacrit">Epoetin Zeta (Retacrit)</option>
    <option value="NeoRecormon">Epoetin Beta (NeoRecormon)</option>
    <option value="Mircera">Methoxy PEG-Epoetin Beta (Mircera)</option>
  </select>

  <div id="sorular"></div>
  <div id="sonuc"></div>
</div>

<script>
let ilaclar = [];

fetch('ilaclar_listesi.json')
  .then(response => response.json())
  .then(data => {
    ilaclar = data.map(item => ({
      isim: item.isim.toLowerCase(),
      barkod: String(item.barkod),
      etken_madde: item.etken_madde.toLowerCase()
    }));
  });

function login() {
  const username = document.getElementById('username').value;
  const password = document.getElementById('password').value;

  if (username === "admin" && password === "73597359") {
    document.getElementById('loginScreen').style.display = "none";
    document.getElementById('mainContent').style.display = "block";
  } else {
    document.getElementById('loginError').innerText = "Hatalı kullanıcı adı veya şifre.";
  }
}

function receteTara() {
  const recete = document.getElementById("recete").value.toLowerCase();
  taramaYap(recete);
}

function dosyaOku() {
  const file = document.getElementById('fileInput').files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    Tesseract.recognize(
      e.target.result,
      'tur',
      { logger: m => { document.getElementById('progress').innerText = m.status + " " + (m.progress*100).toFixed(0) + "%"; } }
    ).then(({ data: { text } }) => {
      document.getElementById('progress').innerText = "Tamamlandı!";
      taramaYap(text.toLowerCase());
    });
  };
  reader.readAsDataURL(file);
}

function taramaYap(metin) {
  let bulunanlar = [];
  ilaclar.forEach(ilac => {
    if (
      ilac.isim.includes(metin) ||
      ilac.barkod.includes(metin) ||
      ilac.etken_madde.includes(metin) ||
      metin.includes(ilac.isim) ||
      metin.includes(ilac.barkod) ||
      metin.includes(ilac.etken_madde)
    ) {
      bulunanlar.push(`${ilac.isim} (Barkod: ${ilac.barkod}, Etken Madde: ${ilac.etken_madde})`);
    }
  });
  gosterBulunanlar(bulunanlar);
}

function gosterBulunanlar(bulunanlar) {
  const bulunanDiv = document.getElementById("bulunanlar");
  if (bulunanlar.length > 0) {
    bulunanDiv.style.display = "block";
    bulunanDiv.innerHTML = "<strong>Bulunan İlaçlar:</strong> <br>" + bulunanlar.join("<br>");
  } else {
    bulunanDiv.style.display = "block";
    bulunanDiv.innerHTML = "Hiçbir eşleşen ilaç bulunamadı.";
  }
}

// Buradan sonrası zaten normal çalışıyordu: 
// SUT kontrol soruları - Exforge, Aranesp vs. (bunlar sende hazır)

</script>

</body>
</html>
