<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>SUT Kontrol Sistemi</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.1/dist/tesseract.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f2f6fc; margin: 0; padding: 20px; }
    h1 { color: #1a237e; }
    textarea, select, button, input { width: 100%; padding: 10px; margin-top: 15px; font-size: 16px; }
    .result { margin-top: 20px; padding: 15px; border-radius: 8px; background: #ffffff; box-shadow: 0px 2px 5px rgba(0,0,0,0.1); }
    .result.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .result.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .result.info { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
  </style>
</head>
<body>

<h1>SUT Kontrol Sistemi</h1>
<!-- Reçete metni yapıştırma -->
<label for="recete">Reçete Metni Yapıştırın:</label>
<textarea id="recete" rows="6" placeholder="Buraya reçete metnini yapıştırın..."></textarea>
<button onclick="receteTara()">Taramaya Başla</button>

<!-- Dosya yükleme alanı -->
<h2>Veya Dosya Yükle (PDF veya Görsel):</h2>
<input type="file" id="fileInput" accept=".pdf,image/*" onchange="dosyaOku()">
<div id="progress"></div>

<!-- Bulunan sonuçlar -->
<div id="bulunanlar" class="result info" style="display:none;"></div>
<script>
const ilaclar = [
  "Exforge", "Micardis Plus", "Telmisartan", "Losartan", "Amlodipin",
  "Aranesp", "Eprex", "Retacrit", "NeoRecormon", "Mircera",
  "valsartan", "telmisartan", "amlodipin", "darbepoetin alfa", "epoetin alfa",
  "epoetin zeta", "epoetin beta", "methoxy peg-epoetin beta"
];

function receteTara() {
  const recete = document.getElementById("recete").value.toLowerCase();
  let bulunanlar = [];

  ilaclar.forEach(ilac => {
    if (recete.includes(ilac.toLowerCase())) {
      bulunanlar.push(ilac);
    }
  });

  gosterBulunanlar(bulunanlar);
}

function dosyaOku() {
  const file = document.getElementById('fileInput').files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    Tesseract.recognize(
      e.target.result,
      'tur', // Türkçe OCR
      { logger: m => { document.getElementById('progress').innerText = m.status + " " + (m.progress*100).toFixed(0) + "%"; } }
    ).then(({ data: { text } }) => {
      document.getElementById('progress').innerText = "Tamamlandı!";
      receteTaramasi(text);
    });
  };
  reader.readAsDataURL(file);
}

function receteTaramasi(text) {
  const recete = text.toLowerCase();
  let bulunanlar = [];

  ilaclar.forEach(ilac => {
    if (recete.includes(ilac.toLowerCase())) {
      bulunanlar.push(ilac);
    }
  });

  gosterBulunanlar(bulunanlar);
}

function gosterBulunanlar(bulunanlar) {
  const bulunanDiv = document.getElementById("bulunanlar");
  if (bulunanlar.length > 0) {
    bulunanDiv.style.display = "block";
    bulunanDiv.innerHTML = "<strong>Bulunan İlaçlar:</strong> " + bulunanlar.join(", ");
  } else {
    bulunanDiv.style.display = "block";
    bulunanDiv.innerHTML = "Hiçbir eşleşen ilaç bulunamadı.";
  }
}
</script>

</body>
</html>
